<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Huel Journey - Feb 10 to Mar 9</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#11088;</text></svg>">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,-apple-system,sans-serif;background:#0d1117;color:#e6edf3;padding:12px;max-width:900px;margin:0 auto}
.clock-bar{text-align:center;margin-bottom:6px}
.clock-time{font-size:1.1rem;color:#e6edf3;font-weight:700;font-variant-numeric:tabular-nums}
.clock-date{color:#8b949e;font-size:.85rem}
.tz-select{background:#21262d;color:#e6edf3;border:1px solid #30363d;padding:3px 6px;border-radius:5px;font-size:.75rem;margin-top:4px;cursor:pointer}
h1{font-size:1.4rem;color:#58a6ff;text-align:center;margin-bottom:4px}
.sub{text-align:center;color:#8b949e;font-size:.85rem;margin-bottom:16px}
.toolbar{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:20px}
.toolbar button{background:#21262d;color:#e6edf3;border:1px solid #30363d;padding:8px 14px;border-radius:6px;cursor:pointer;font-size:.8rem}
.toolbar button:hover{background:#30363d}
.inv-panel{background:#161b22;border:1px solid #21262d;border-radius:10px;padding:14px;margin-bottom:16px}
.inv-toggle{background:none;border:none;color:#58a6ff;cursor:pointer;font-size:.9rem;font-weight:600;width:100%;text-align:left;padding:0}
.inv-body{margin-top:10px;display:none}
.inv-body.open{display:block}
.inv-section-title{font-size:.8rem;color:#8b949e;margin-bottom:6px;border-bottom:1px solid #21262d;padding-bottom:3px}
.inv-item{display:flex;align-items:center;padding:4px 0;font-size:.8rem;gap:6px}
.inv-item .inv-name{flex:1}
.inv-item .inv-used{color:#484f58;font-size:.75rem}
.inv-item .inv-left{color:#3fb950;font-weight:600;min-width:18px;text-align:center}
.inv-item.depleted .inv-name{color:#484f58;text-decoration:line-through}
.inv-item.depleted .inv-left{color:#da3633}
.inv-btn{background:#21262d;border:1px solid #30363d;color:#e6edf3;width:22px;height:22px;border-radius:4px;cursor:pointer;font-size:.8rem;display:flex;align-items:center;justify-content:center;padding:0}
.inv-btn:hover{background:#30363d}
.inv-del{background:none;border:none;color:#484f58;cursor:pointer;font-size:.7rem;padding:2px 4px;border-radius:3px}
.inv-del:hover{color:#da3633;background:#da363320}
.inv-add{margin-top:10px;padding-top:10px;border-top:1px solid #21262d}
.inv-add input{background:#0d1117;border:1px solid #30363d;color:#e6edf3;padding:6px 8px;border-radius:5px;font-size:.8rem;width:100%}
.inv-add input:focus{outline:none;border-color:#58a6ff}
.inv-add .inv-hint{font-size:.65rem;color:#484f58;margin-top:3px}
.day-card{background:#161b22;border:1px solid #21262d;border-radius:10px;padding:14px;margin-bottom:12px;opacity:.55;transition:opacity .3s;position:relative}
.day-body{display:flex;gap:12px}
.day-left{flex:1;min-width:0}
.day-cal{display:flex;flex-direction:column;align-items:center;justify-content:center;min-width:90px;padding:8px;background:#0d1117;border-radius:8px;gap:4px}
.day-cal .cal-total{font-size:1.2rem;font-weight:700;color:#d2a8ff}
.day-cal .cal-label{font-size:.65rem;color:#8b949e;text-transform:uppercase}
.day-cal .cal-extra{display:flex;align-items:center;gap:4px;margin-top:2px}
.day-cal .cal-extra input{width:60px;background:#161b22;border:1px solid #30363d;color:#d2a8ff;padding:3px 5px;border-radius:4px;font-size:.8rem;text-align:center}
.day-cal .cal-extra input:focus{outline:none;border-color:#d2a8ff}
.day-cal .cal-extra-label{font-size:.6rem;color:#8b949e}
.day-card.today{opacity:1;border-color:#58a6ff;border-width:2px;box-shadow:0 0 12px #58a6ff30}
.day-card.sunday{border-color:#da3633;border-width:2px}
.day-card.sunday.today{border-color:#58a6ff;box-shadow:0 0 12px #58a6ff30}
.day-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap;gap:8px}
.day-label{font-weight:700;font-size:1rem}
.day-label .id{color:#58a6ff;margin-right:6px}
.day-label .dow{color:#8b949e;font-weight:400;font-size:.85rem}
.day-label .sun-tag{color:#da3633;font-size:.75rem;font-weight:600;background:#da363320;padding:2px 6px;border-radius:4px;margin-left:6px}
.day-label .today-tag{color:#58a6ff;font-size:.75rem;font-weight:600;background:#58a6ff20;padding:2px 6px;border-radius:4px;margin-left:6px}
.weight-box{display:flex;align-items:center;gap:6px}
.weight-box label{color:#8b949e;font-size:.85rem}
.weight-box input{width:80px;background:#0d1117;border:1px solid #30363d;color:#e6edf3;padding:5px 8px;border-radius:5px;font-size:.95rem;text-align:center}
.weight-box input:focus{outline:none;border-color:#58a6ff}
.checks{margin-top:8px}
.check-row{display:flex;flex-wrap:wrap;gap:6px 10px}
.check-row+.check-row{margin-top:6px}
.chk{display:flex;align-items:center;gap:5px;font-size:.8rem;padding:3px 0;transition:opacity .2s}
.chk input[type=checkbox]{width:16px;height:16px;accent-color:#238636;cursor:pointer}
.chk label{cursor:pointer;white-space:nowrap}
.chk.neg label{color:#f0883e}
.chk.pos label{color:#3fb950}
.chk.fast label{color:#da3633;font-weight:600}
.chk.done{opacity:.35}
.chk.done label{text-decoration:line-through}
.meal-select{background:#0d1117;color:#3fb950;border:1px solid #30363d;padding:2px 4px;border-radius:4px;font-size:.7rem;margin-left:4px;cursor:pointer;max-width:120px}
.meal-select:focus{outline:none;border-color:#3fb950}
.meal-picks{margin-top:6px;display:flex;flex-wrap:wrap;gap:4px}
.meal-picks .pick-tag{font-size:.65rem;background:#21262d;padding:2px 6px;border-radius:3px;color:#8b949e}
.summary{background:#161b22;border:1px solid #21262d;border-radius:10px;padding:16px;margin-bottom:20px}
.summary-row{display:flex;flex-wrap:wrap;justify-content:center;gap:4px 20px}
.summary-row+.summary-row{margin-top:6px;padding-top:6px;border-top:1px solid #21262d}
.summary .stat{font-size:.9rem;text-align:center}
.summary strong{color:#58a6ff}
.summary .cal{color:#d2a8ff}
.kg{color:#8b949e;font-size:.75rem}
</style>
</head>
<body>

<div class="clock-bar">
  <div class="clock-time" id="clock"></div>
  <div class="clock-date" id="clock-date"></div>
  <select class="tz-select" id="tz-select" onchange="changeTZ(this.value)"></select>
</div>

<h1>Huel Journey</h1>
<p class="sub">Daily Tracker &middot; Feb 10 &ndash; Mar 9, 2026 &middot; 28 days &middot; 4 weeks</p>

<div class="inv-panel">
  <button class="inv-toggle" onclick="toggleInv()">Meal Inventory ▸</button>
  <div class="inv-body" id="inv-body"></div>
</div>

<div class="summary" id="summary"></div>

<div class="toolbar">
<button onclick="exportWeightsCSV()">Download Weights CSV</button>
<button onclick="exportAllCSV()">Download All Data CSV</button>
</div>

<div id="days"></div>

<script>
// ── Inventory ──
const DEFAULT_STOCK={
  'Katsu Curry Noodles':15,
  'Hoisin Duck Noodles':15,
  'Korean BBQ Noodles':15,
  'Mac & Cheeze':14,
  'Chickn & Mushroom Pasta':7,
  'Mexican Chilli':7,
  'Pasta Bolognese':7,
  'Cajun Pasta':7,
  'Thai Green Curry':7,
  'Madras':7
};
const INV_KEY='huel-journey-inv';
let invStock=JSON.parse(localStorage.getItem(INV_KEY))||null;
if(!invStock) invStock={...DEFAULT_STOCK};
function saveInv(){localStorage.setItem(INV_KEY,JSON.stringify(invStock));}
function getMealFlavors(){return Object.keys(invStock);}

const MEAL_SLOTS=['Huel Meal 1','Huel Meal 2','Huel Meal 3','Huel Meal 4'];

// ── Timezone ──
const TIMEZONES=['Europe/Rome','Europe/London','Europe/Berlin','Europe/Paris','Europe/Madrid','Europe/Amsterdam','Europe/Brussels','Europe/Vienna','Europe/Warsaw','Europe/Zurich','Europe/Athens','Europe/Bucharest','Europe/Helsinki','Europe/Istanbul','Europe/Moscow','US/Eastern','US/Central','US/Mountain','US/Pacific','Asia/Tokyo','Asia/Shanghai','Asia/Kolkata','Asia/Dubai','Australia/Sydney','Pacific/Auckland','UTC'];
const TZ_KEY='huel-journey-tz';
let tz=localStorage.getItem(TZ_KEY)||'Europe/Rome';
function initTZSelect(){const sel=document.getElementById('tz-select');TIMEZONES.forEach(t=>{const opt=document.createElement('option');opt.value=t;opt.textContent=t.replace(/_/g,' ');if(t===tz) opt.selected=true;sel.appendChild(opt);});}
function changeTZ(v){tz=v;localStorage.setItem(TZ_KEY,tz);render();setTimeout(()=>{const el=document.querySelector('.day-card.today');if(el) el.scrollIntoView({behavior:'smooth',block:'center'});},50);}
function nowInTZ(){return new Date(new Date().toLocaleString('en-US',{timeZone:tz}))}
function todayKeyInTZ(){const n=nowInTZ();return n.getFullYear()+'-'+String(n.getMonth()+1).padStart(2,'0')+'-'+String(n.getDate()).padStart(2,'0')}
function updateClock(){
  const n=nowInTZ();const hr=n.getHours();const ampm=hr>=12?'PM':'AM';const h12=hr%12||12;
  const m=String(n.getMinutes()).padStart(2,'0');const s=String(n.getSeconds()).padStart(2,'0');
  document.getElementById('clock').textContent=h12+':'+m+':'+s+' '+ampm;
  const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const months=['January','February','March','April','May','June','July','August','September','October','November','December'];
  document.getElementById('clock-date').textContent=days[n.getDay()]+', '+n.getDate()+' '+months[n.getMonth()]+' '+n.getFullYear()+' — '+tz.replace(/_/g,' ');
}

// ── Date range ──
const DAY_KEYS=[];const DAY_DATA={};
(function(){let y=2026,m=2,d=10;const end='2026-03-09';while(true){const key=y+'-'+String(m).padStart(2,'0')+'-'+String(d).padStart(2,'0');const dateObj=new Date(y,m-1,d);DAY_KEYS.push(key);DAY_DATA[key]={date:dateObj,dow:dateObj.getDay()};if(key===end) break;d++;const maxD=new Date(y,m,0).getDate();if(d>maxD){d=1;m++;if(m>12){m=1;y++;}}}})();

// ── Constants ──
const NEG=['NO CIGARETTE','NO ALCOHOL','NO EXTRA FOOD OR DRINK','NO PHONE','NO WASTE'];
const POS_BASE=['Creatine','Daily Greens','Huel Meal 1','Huel Meal 2','Huel Meal 3','Huel Meal 4','Huel Drink','Huel Bar 1','Huel Bar 2'];
const CAL_MAP={'Huel Meal 1':400,'Huel Meal 2':400,'Huel Meal 3':400,'Huel Meal 4':400,'Huel Drink':400,'Daily Greens':25,'1 Whole Fruit':100,'Huel Bar 1':210,'Huel Bar 2':210};
const DB_NAME='huel-journey';const LS_KEY='huel-journey-data';
let data={};

function getChecks(dow){
  const sun=dow===0;const sat=dow===6;const list=[];
  if(sun) list.push({id:'FASTING',type:'fast'});
  NEG.forEach(n=>list.push({id:n,type:'neg'}));
  if(!sun){POS_BASE.forEach(p=>list.push({id:p,type:'pos'}));if(!sat) list.push({id:'1 Whole Fruit',type:'pos'});}
  return list;
}
function dayCal(key){
  const row=data[key];if(!row) return 0;let cal=0;
  for(const [id,v] of Object.entries(row.checks||{})){if(v && CAL_MAP[id]) cal+=CAL_MAP[id];}
  cal+=parseInt(row.extraCal)||0;return cal;
}
function fmtDisplay(dow,date){const days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];const months=['Jan','Feb','Mar'];return days[dow]+', '+months[date.getMonth()]+' '+date.getDate();}

// ── Inventory computation ──
function getConsumed(){
  const meals={};getMealFlavors().forEach(f=>meals[f]=0);
  DAY_KEYS.forEach(k=>{
    const row=data[k];if(!row||!row.picks) return;
    MEAL_SLOTS.forEach(slot=>{
      const pick=row.picks[slot];
      if(pick && row.checks[slot] && meals[pick]!==undefined) meals[pick]++;
    });
  });
  return meals;
}

function renderInventory(){
  const consumed=getConsumed();
  const el=document.getElementById('inv-body');
  const flavors=getMealFlavors();
  const items=flavors.map(f=>({name:f,total:invStock[f],used:consumed[f]||0,left:invStock[f]-(consumed[f]||0)})).sort((a,b)=>b.left-a.left);
  const totalLeft=items.reduce((a,b)=>a+Math.max(0,b.left),0);

  const mkItem=it=>{
    const dep=it.left<=0?' depleted':'';
    const eName=it.name.replace(/'/g,"\\'");
    return `<div class="inv-item${dep}">
      <button class="inv-btn" onclick="invAdj('${eName}',-1)">-</button>
      <span class="inv-left">${Math.max(0,it.left)}</span>
      <button class="inv-btn" onclick="invAdj('${eName}',1)">+</button>
      <span class="inv-name">${it.name}</span>
      <span class="inv-used">${it.used}/${it.total}</span>
      <button class="inv-del" onclick="invDel('${eName}')" title="Remove">✕</button>
    </div>`;
  };

  el.innerHTML=
    `<div class="inv-section-title">Meal Inventory (${totalLeft} remaining)</div>`+
    items.map(mkItem).join('')+
    `<div class="inv-add">
      <input type="text" id="inv-add-input" placeholder="Add: name - qty, name - qty" onkeydown="if(event.key==='Enter')addInvItems()">
      <div class="inv-hint">Format: Katsu Curry - 7, Mac Cheeze - 14 &nbsp;or&nbsp; just: Tomato Pasta - 5</div>
    </div>`;
}

function invAdj(name,delta){
  if(invStock[name]===undefined) return;
  invStock[name]=Math.max(0,invStock[name]+delta);
  saveInv();renderInventory();
}
function invDel(name){
  if(!confirm('Remove "'+name+'" from inventory?')) return;
  delete invStock[name];
  saveInv();renderInventory();render();
}

function addInvItems(){
  const input=document.getElementById('inv-add-input');
  const val=input.value.trim();
  if(!val) return;
  const parts=val.split(',');
  parts.forEach(p=>{
    const match=p.trim().match(/^(.+?)\s*-\s*(\d+)$/);
    if(match){
      const name=match[1].trim();
      const qty=parseInt(match[2]);
      if(name && qty>0){
        invStock[name]=(invStock[name]||0)+qty;
      }
    }
  });
  saveInv();input.value='';renderInventory();render();
}

function toggleInv(){
  const body=document.getElementById('inv-body');const btn=body.previousElementSibling;
  body.classList.toggle('open');btn.textContent=body.classList.contains('open')?'Meal Inventory ▾':'Meal Inventory ▸';
}

// ── Storage ──
function save(){localStorage.setItem(LS_KEY,JSON.stringify(data));saveIDB();}
function saveIDB(){try{const req=indexedDB.open(DB_NAME,1);req.onupgradeneeded=e=>{e.target.result.createObjectStore('data')};req.onsuccess=e=>{const db=e.target.result;const tx=db.transaction('data','readwrite');tx.objectStore('data').put(JSON.stringify(data),'main');};}catch(e){}}
function loadIDB(){return new Promise(res=>{try{const req=indexedDB.open(DB_NAME,1);req.onupgradeneeded=e=>{e.target.result.createObjectStore('data')};req.onsuccess=e=>{const db=e.target.result;const tx=db.transaction('data','readonly');const g=tx.objectStore('data').get('main');g.onsuccess=()=>res(g.result?JSON.parse(g.result):null);g.onerror=()=>res(null);};req.onerror=()=>res(null);}catch(e){res(null)}});}

// ── Init ──
async function init(){
  initTZSelect();updateClock();setInterval(updateClock,1000);
  const ls=localStorage.getItem(LS_KEY);const idb=await loadIDB();
  if(ls) data=JSON.parse(ls);
  if(idb){if(Object.keys(idb).length>Object.keys(data).length) data=idb;}
  if(!data||typeof data!=='object') data={};
  render();
  setTimeout(()=>{const el=document.querySelector('.day-card.today');if(el) el.scrollIntoView({behavior:'smooth',block:'center'});},100);
}

// ── Render helpers ──
function buildMkChk(key){
  const flavors=getMealFlavors();
  return c=>{
    const cid=key+'_'+c.id.replace(/\s+/g,'_');
    const checked=data[key].checks[c.id];
    const chkAttr=checked?'checked':'';
    const doneClass=checked?' done':'';
    const isMealSlot=MEAL_SLOTS.includes(c.id);
    let selectHTML='';
    if(checked && isMealSlot){
      const opts=flavors.map(f=>`<option value="${f}"${data[key].picks[c.id]===f?' selected':''}>${f}</option>`).join('');
      selectHTML=`<select class="meal-select" onchange="pickMeal('${key}','${c.id}',this.value)"><option value="">-- pick --</option>${opts}</select>`;
    }
    return `<div class="chk ${c.type}${doneClass}" id="w_${cid}"><input type="checkbox" id="${cid}" ${chkAttr} onchange="toggle('${key}','${c.id.replace(/'/g,"\\'")}',this.checked)"><label for="${cid}">${c.id}</label>${selectHTML}</div>`;
  };
}

function render(){
  const container=document.getElementById('days');const tk=todayKeyInTZ();
  container.innerHTML='';
  DAY_KEYS.forEach((key,i)=>{
    const info=DAY_DATA[key];
    if(!data[key]) data[key]={weight:'',checks:{},extraCal:'',picks:{}};
    if(!data[key].picks) data[key].picks={};
    if(data[key].extraCal===undefined) data[key].extraCal='';
    const sun=info.dow===0;const isToday=key===tk;
    const card=document.createElement('div');
    let cls='day-card';if(sun) cls+=' sunday';if(isToday) cls+=' today';
    card.className=cls;card.id='day-'+key;

    const checks=getChecks(info.dow);
    const mkChk=buildMkChk(key);
    const posRow=checks.filter(c=>c.type==='pos').map(mkChk).join('');
    const negRow=checks.filter(c=>c.type==='fast'||c.type==='neg').map(mkChk).join('');
    const totalCal=dayCal(key);
    const picks=data[key].picks||{};
    const pickTags=Object.entries(picks).filter(([slot,val])=>val&&data[key].checks[slot]).map(([slot,val])=>`<span class="pick-tag">${slot.replace('Huel ','')}: ${val}</span>`).join('');

    card.innerHTML=`
      <div class="day-header">
        <div class="day-label"><span class="id">#${i+1}</span>${info.date.getDate()} <span class="dow">${fmtDisplay(info.dow,info.date)}</span>${sun?'<span class="sun-tag">FASTING DAY</span>':''}${isToday?'<span class="today-tag">TODAY</span>':''}</div>
        <div class="weight-box"><label>Weight</label><input type="number" step="0.1" min="30" max="300" value="${data[key].weight}" placeholder="kg" onchange="setWeight('${key}',this.value)" onfocus="this.select()"><span class="kg">kg</span></div>
      </div>
      <div class="day-body">
        <div class="day-left">
          <div class="checks">${posRow?`<div class="check-row">${posRow}</div>`:''}<div class="check-row">${negRow}</div></div>
          ${pickTags?`<div class="meal-picks">${pickTags}</div>`:''}
        </div>
        <div class="day-cal">
          <div class="cal-total">${totalCal}</div><div class="cal-label">kcal</div>
          <div class="cal-extra"><input type="number" min="0" step="10" value="${data[key].extraCal||''}" placeholder="+extra" onchange="setExtra('${key}',this.value)" onfocus="this.select()"></div>
          <div class="cal-extra-label">extra cal</div>
        </div>
      </div>`;
    container.appendChild(card);
  });
  updateSummary();renderInventory();
}

// ── Actions ──
function setWeight(key,val){data[key].weight=val;save();updateSummary();}
function setExtra(key,val){data[key].extraCal=val;save();const card=document.getElementById('day-'+key);if(card){const t=card.querySelector('.cal-total');if(t)t.textContent=dayCal(key);}updateSummary();}
function pickMeal(key,slot,val){if(!data[key].picks) data[key].picks={};data[key].picks[slot]=val;save();renderInventory();}

function toggle(key,check,val){
  data[key].checks[check]=val;
  if(!val && data[key].picks) data[key].picks[check]='';
  save();
  const card=document.getElementById('day-'+key);
  if(card){
    const info=DAY_DATA[key];const checks=getChecks(info.dow);
    const mkChk=buildMkChk(key);
    const posRow=checks.filter(c=>c.type==='pos').map(mkChk).join('');
    const negRow=checks.filter(c=>c.type==='fast'||c.type==='neg').map(mkChk).join('');
    const checksEl=card.querySelector('.checks');
    if(checksEl) checksEl.innerHTML=`${posRow?`<div class="check-row">${posRow}</div>`:''}<div class="check-row">${negRow}</div>`;
    const picks=data[key].picks||{};
    const pickTags=Object.entries(picks).filter(([slot,v])=>v&&data[key].checks[slot]).map(([slot,v])=>`<span class="pick-tag">${slot.replace('Huel ','')}: ${v}</span>`).join('');
    let picksEl=card.querySelector('.meal-picks');
    if(pickTags){if(!picksEl){picksEl=document.createElement('div');picksEl.className='meal-picks';card.querySelector('.day-left').appendChild(picksEl);}picksEl.innerHTML=pickTags;}
    else if(picksEl){picksEl.remove();}
    const t=card.querySelector('.cal-total');if(t)t.textContent=dayCal(key);
  }
  updateSummary();renderInventory();
}

// ── Summary ──
function updateSummary(){
  const entries=DAY_KEYS.map(k=>({key:k,w:parseFloat(data[k]?.weight)})).filter(e=>!isNaN(e.w));
  const el=document.getElementById('summary');
  const calDays=[];DAY_KEYS.forEach(k=>{const c=dayCal(k);if(c>0) calDays.push(c);});
  const totalCal=calDays.reduce((a,b)=>a+b,0);const avgCal=calDays.length?Math.round(totalCal/calDays.length):0;
  const lowCal=calDays.length?Math.min(...calDays):0;const highCal=calDays.length?Math.max(...calDays):0;
  if(entries.length===0&&calDays.length===0){el.innerHTML='<div class="summary-row"><div class="stat">Enter your first weight to see stats</div></div>';return;}
  let wHTML='';
  if(entries.length>0){
    const first=entries[0].w,last=entries[entries.length-1].w,diff=last-first,sign=diff>0?'+':'';
    const fi=DAY_KEYS.indexOf(entries[0].key),li=DAY_KEYS.indexOf(entries[entries.length-1].key),daySpan=Math.max(1,li-fi);
    const avg=(diff/daySpan).toFixed(2),as=avg>0?'+':'',low=Math.min(...entries.map(e=>e.w)),high=Math.max(...entries.map(e=>e.w));
    wHTML=`<div class="summary-row"><div class="stat">Start: <strong>${first} kg</strong></div><div class="stat">Current: <strong>${last} kg</strong></div><div class="stat">Change: <strong>${sign}${diff.toFixed(1)} kg</strong></div><div class="stat">Avg/day: <strong>${as}${avg} kg</strong></div><div class="stat">Entries: <strong>${entries.length}</strong></div><div class="stat">Days: <strong>${daySpan}</strong></div><div class="stat">Low: <strong>${low} kg</strong></div><div class="stat">High: <strong>${high} kg</strong></div></div>`;
  }
  let cHTML='';
  if(calDays.length>0){
    cHTML=`<div class="summary-row"><div class="stat">Total Cal: <strong class="cal">${totalCal} kcal</strong></div><div class="stat">Avg/day: <strong class="cal">${avgCal} kcal</strong></div><div class="stat">Low Day: <strong class="cal">${lowCal} kcal</strong></div><div class="stat">High Day: <strong class="cal">${highCal} kcal</strong></div><div class="stat">Days w/ food: <strong class="cal">${calDays.length}</strong></div></div>`;
  }
  el.innerHTML=wHTML+cHTML;
}

// ── Export ──
function exportWeightsCSV(){let csv='Date,Day,Weight (kg)\n';DAY_KEYS.forEach(k=>{const info=DAY_DATA[k];csv+=`${k},${fmtDisplay(info.dow,info.date)},${data[k]?.weight||''}\n`;});dl(csv,'huel-weights.csv','text/csv');}
function exportAllCSV(){
  const allChecks=[...new Set(DAY_KEYS.flatMap(k=>getChecks(DAY_DATA[k].dow).map(c=>c.id)))];
  let csv='#,Date,Day,Weight (kg),Huel Cal,Extra Cal,Total Cal,'+allChecks.join(',')+',Meal Picks\n';
  DAY_KEYS.forEach((k,i)=>{const info=DAY_DATA[k];const row=data[k]||{weight:'',checks:{},extraCal:'',picks:{}};const dayChecks=getChecks(info.dow).map(x=>x.id);const totalCal=dayCal(k);const extra=parseInt(row.extraCal)||0;const huelCal=totalCal-extra;const vals=allChecks.map(c=>{if(!dayChecks.includes(c)) return 'N/A';return row.checks[c]?'YES':'NO';});const picks=Object.entries(row.picks||{}).filter(([s,v])=>v&&row.checks[s]).map(([s,v])=>s.replace('Huel ','')+':'+v).join('; ');csv+=`${i+1},${k},${fmtDisplay(info.dow,info.date)},${row.weight||''},${huelCal},${extra},${totalCal},${vals.join(',')},${picks}\n`;});
  dl(csv,'huel-journey-full.csv','text/csv');
}
function dl(content,name,type){const blob=new Blob([content],{type});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=name;a.click();URL.revokeObjectURL(a.href);}

init();
</script>
</body>
</html>
